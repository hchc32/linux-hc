## 单例模式

### 单例模式分为两种:

+ 懒汉模式:第一次调用才初始化,有延迟加载的效果,以时间换空间
> 优点:第一次使用实例对象时，创建对象，进程启动无负载，多个单例实例启动顺序自由控制
>
> 缺点:复杂

+ 饿汉模式:程序开始就初始化,以空间换时间

> 优点:简单
>
> 缺点:可能会导致进程启动慢,如果有多个单例类的对象实例启动顺序不确定

#### 懒汉模式一：双检索+自动回收

```c++
class Singleton
{
public:
    Singleton *GetInsTance()
    {
        if(m_PInstance==nullptr)
        {
            m_tex.lock();
            if(m_PInstance == nullptr)
            {
                m_PInstance = new Singleton();
            }
            m_tex.unlock();
        }
        return m_PInstance;
    }
    class CGarbo
    {
        ~CGarbo()
        {
            if(m_PInstance != nullptr)
            {
                delete  Singleton::m_PInstance;
                Singleton::m_PInstance = nullptr;
            }
        }
    };
    //定义一个静态变量,程序结束时,系统会自动调用他的析构函数.
    static CGarbo cgarbo;
private:
    //私有构造函数
    Singleton() {}
    //拷贝构造函数
    Singleton(Singleton const&) = delete;
    //拷贝赋值函数
    Singleton& operator=(Singleton &) = delete;

private:
    static Singleton* m_PInstance;
    static mutex m_tex;
};
```

#### 懒汉模式二:静态局部变量,避免自己回收资源

```c++
//静态局部变量，避免自己回收资源
class Singleton
{
public:
    static Singleton* GetInsTance()
    {
        static Singleton instance;
        return &instance;
    }
private:
    Singleton() {};
    Singleton(const Singleton&) = delete;
    Singleton& operator = (const Singleton &) = delete;
};
```

#### 饿汉模式一:

```c++
//饿汉模式一
//初始化顺序不定可能会出错
class Singleton
{
public:
    static Singleton* GetInsTance()
    {
        return &m_instance;
    }
private:
    Singleton() {};
    Singleton(Singleton const&);
    Singleton& operator= (Singleton const&);

    static Singleton m_instance;
};
```

####　饿汉模式二(boost实现):

```c++
//饿汉模式二(boost实现)
//用辅助类
class Singleton
{
public:
    static Singleton* GetInsTance()
    {
        static Singleton instance;
        return &instance;
    }

protected:
    //辅助代理类
    struct Object_Creator
    {
        Object_Creator()
        {
            Singleton::GetInsTance();
        }
    }
    static Object_Creator _object_creator;
    Singleton() {};
    ~Singleton() {};
};
```



